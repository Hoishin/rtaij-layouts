<link rel="import" href="../../../bower_components/polymer/polymer-element.html">
<link rel="import" href="../../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../../bower_components/iron-icons/av-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/editor-icons.html">
<link rel="import" href="../../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../bower_components/paper-input/paper-input.html">
<link rel="import" href="rtaij-timekeeper-runner.html">

<dom-module id="rtaij-timekeeper">
	<template>
		<style include="iron-flex iron-flex-alignment">
			:host {
				@apply --layout-vertical;
				width: 100%;
				white-space: nowrap;
				height: 500px;
			}

			.green {
				--bg-color: #43ac6a;
			}

			.yellow {
				--bg-color: #e99002;
			}

			.purple {
				--bg-color: #a50074;
			}

			.gray {
				--bg-color: #555555;
			}

			:host([checklist-incomplete]) #timer {
				background-color: #ff6d6b;
				color: white;
			}

			:host([paused]) #timer {
				background-color: #e99002;
				color: white;
			}

			#timer {
				@apply --layout-horizontal;
				@apply --layout-center;
				@apply --layout-around-justified;
				@apply --layout-flex-none;
				font-weight: 700;
				height: 105px;
			}

			#timer-time {
				font-size: 55px;
			}

			#timer paper-button {
				width: 128px;
				height: 30px;
				margin: 4px 3px;
			}

			#timer paper-button {
				@apply --layout-horizontal;
				@apply --layout-center-center;
				--paper-button: {
					color: white;
					padding: 0;
					font-size: 16px;
					font-weight: bold;
					background-color: var(--bg-color);
				}
			}

			paper-dialog {
				font-size: larger;
			}

			paper-dialog paper-input {
				--paper-input-container-input: {
					font-size: larger;
				}
				;

				--paper-input-container-label: {
					font-size: larger;
				}
				;
			}

			[hidden] {
				display: none !important;
			}
		</style>
		<div id="timer">

			<!-- Master timer -->

			<span id="timer-time">[[time]]</span>

			<!-- Master timer control -->

			<div class="layout vertical">
				<div class="layout horizontal">
					<paper-button raised class="green" on-click="startTimer" disabled="[[calcStartDisabled(checklistComplete, state)]]">
						<iron-icon icon="av:play-arrow"></iron-icon>
						&nbsp;Start
					</paper-button>

					<paper-button raised class="yellow" on-click="stopTimer" disabled="[[calcPauseDisabled(state)]]">
						<iron-icon icon="av:pause"></iron-icon>
						&nbsp;Pause
					</paper-button>
				</div>

				<div class="layout horizontal">
					<paper-button raised class="purple" on-click="confirmReset">
						<iron-icon icon="refresh"></iron-icon>
						&nbsp;Reset
					</paper-button>

					<paper-button raised class="purple" on-click="editMasterTime" disabled="[[!checklistComplete]]">
						<iron-icon icon="editor:mode-edit"></iron-icon>
						&nbsp;Edit
					</paper-button>
				</div>
			</div>
		</div>

		<!-- Timer for each runner -->

		<template is="dom-repeat" items="[[runners]]" as="runner">
			<rtaij-timekeeper-runner runner="[[runner]]" index="[[index]]" results="[[results]]" state="[[state]]" on-edit-time="editRunnerTime"></rtaij-timekeeper-runner>
		</template>

		<!-- Dialogs -->

		<paper-dialog id="resetDialog" with-backdrop>
			<p>
				リセットしてよろしいですか？全ての走者のタイムと全体のタイマーが元に戻ります。
			</p>
			<div class="buttons">
				<paper-button dialog-confirm on-click="resetTimer">リセットする</paper-button>
				<paper-button dialog-dismiss autofocus>キャンセル</paper-button>
			</div>
		</paper-dialog>

		<paper-dialog id="editDialog" with-backdrop>
			<p id="editDialog-text"></p>
			<paper-input id="editDialog-input" label="Final Time" placeholder="00:00:00" auto-validate prevent-invalid-input allowed-pattern="[0-9:]"></paper-input>
			<div class="buttons">
				<paper-button dialog-confirm on-click="saveEditedTime">保存</paper-button>
				<paper-button dialog-dismiss autofocus>キャンセル</paper-button>
			</div>
		</paper-dialog>
	</template>
	<script src="rtaij-timekeeper.js"></script>
</dom-module>